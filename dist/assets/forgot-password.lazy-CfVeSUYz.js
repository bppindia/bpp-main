import{ae as v,af as j,ag as N,r as u,u as V,ah as S,ai as E,aj as i,j as e,a8 as q,a9 as D,y as $,aa as A,ak as M,al as H,ab as J,I as p,B as w,am as T,an as C,ad as W,J as n,c as G}from"./index-BG0uviZH.js";const y={forgotPassword:async s=>{try{const t=await j("/auth/forgot-password",s);return N(t)}catch(t){throw t instanceof Error?new Error(t.message):t}},resetPassword:async s=>{try{const t=await j("/auth/reset-password",s);return N(t)}catch(t){throw t instanceof Error?new Error(t.message):t}},logout:async()=>{try{return v.remove("authToken"),v.remove("sessionId"),await j("/auth/logout",{}),{success:!0,message:"Logged out successfully"}}catch(s){throw s instanceof Error?new Error(s.message):s}}},K=i.object({email:i.string().email("Invalid email address").optional().or(i.literal("")),phone:i.string().regex(/^\+91\d{10}$/,"Invalid phone number").optional().or(i.literal(""))}).refine(s=>{var t,l;return!!((t=s.email)!=null&&t.trim()||(l=s.phone)!=null&&l.trim())},{message:"Either email or phone is required",path:["email"]}),Q=i.object({otp:i.string().length(4,"OTP must be 4 digits"),newPassword:i.string().min(1,"Password is required"),confirmPassword:i.string().min(1,"Confirm Password is required"),showPassword:i.boolean().default(!1),showConfirmPassword:i.boolean().default(!1)}).refine(s=>s.newPassword===s.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]}),U=()=>{const[s,t]=u.useState(1),[l,O]=u.useState({type:"",value:""}),[x,g]=u.useState(300),[k,P]=u.useState(!1),[f,h]=u.useState(!1),R=V(),m=S({resolver:E(K),defaultValues:{email:"",phone:""}}),r=S({resolver:E(Q),defaultValues:{otp:"",newPassword:"",confirmPassword:"",showPassword:!1,showConfirmPassword:!1}});u.useEffect(()=>{let a;return s===2&&x>0?a=setInterval(()=>{g(o=>o-1)},1e3):x===0&&P(!0),()=>{a&&clearInterval(a)}},[s,x]);const F=a=>{const o=Math.floor(a/60),d=a%60;return`${o}:${d.toString().padStart(2,"0")}`},I=async a=>{var o,d;try{h(!0);const c={email:((o=a.email)==null?void 0:o.trim())||void 0,phone:((d=a.phone)==null?void 0:d.trim())||void 0},B=c.email?{email:c.email}:{phone:c.phone},b=await y.forgotPassword(B);if(!b.success){n.error(b.message||"Failed to send OTP");return}O({type:c.email?"email":"phone",value:c.email||c.phone||""}),t(2),g(300),P(!1),n.success("OTP sent successfully")}catch(c){c instanceof Error?n.error(c.message):n.error("Failed to send OTP. Please try again.")}finally{h(!1)}},z=async()=>{try{h(!0);const a=l.type==="email"?{email:l.value}:{phone:l.value},o=await y.forgotPassword(a);if(!o.success){n.error(o.message||"Failed to resend OTP");return}g(300),P(!1),n.success("OTP resent successfully")}catch(a){a instanceof Error?n.error(a.message):n.error("Failed to resend OTP. Please try again.")}finally{h(!1)}},L=async a=>{try{h(!0);const o={otp:a.otp,newPassword:a.newPassword,[l.type]:l.value},d=await y.resetPassword(o);if(!d.success){n.error(d.message||"Failed to reset password");return}n.success("Password reset successfully"),setTimeout(()=>R({to:"/sign-in"}),3e3)}catch(o){o instanceof Error?n.error(o.message):n.error("Failed to reset password. Please try again.")}finally{h(!1)}};return e.jsxs("section",{className:"mx-auto flex min-h-screen items-center justify-center bg-background px-4 py-6 sm:p-8 md:p-10",children:[e.jsxs(q,{className:"mx-auto w-full max-w-xl border-gray-300 p-4",children:[e.jsxs(D,{children:[e.jsx("div",{className:"flex items-center justify-center text-xl font-bold text-blue-800",children:e.jsx($,{to:"/",children:e.jsx("img",{src:A,alt:"BPP Logo",className:"w-[120px] rounded-lg object-contain"})})}),e.jsxs("h2",{className:"text-center text-2xl font-black text-neutral-800 dark:text-neutral-200",children:[e.jsx("div",{children:"Welcome to"}),e.jsx("div",{style:{color:"#79A5F2"},children:"Bharatiya Popular Party"})]}),e.jsx(M,{className:"text-lg",children:"Reset Password"}),e.jsx(H,{children:s===1?"Enter your email or phone number to receive OTP":"Enter the OTP and your new password"})]}),e.jsx(J,{children:s===1?e.jsxs("form",{onSubmit:m.handleSubmit(I),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Email"}),e.jsx(p,{type:"email",...m.register("email"),placeholder:"Enter email"}),m.formState.errors.email&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:m.formState.errors.email.message})]}),e.jsx("p",{className:"my-2 text-center",children:"OR"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Phone"}),e.jsx(p,{placeholder:"+91 Phone number",...m.register("phone")}),m.formState.errors.phone&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:m.formState.errors.phone.message})]}),e.jsx(w,{type:"submit",className:"mt-4 w-full",disabled:f,children:f?"Sending OTP...":"Send OTP"})]}):e.jsxs("form",{onSubmit:r.handleSubmit(L),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:l.type==="email"?"Email":"Phone"}),e.jsx(p,{value:l.value,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"OTP"}),e.jsx(p,{placeholder:"Enter 4-digit OTP",maxLength:4,type:"text",inputMode:"numeric",...r.register("otp")}),r.formState.errors.otp&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.formState.errors.otp.message}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Time remaining: ",F(x)]}),k&&e.jsx(w,{type:"button",variant:"link",className:"h-auto p-0 text-blue-600",onClick:z,disabled:f,children:"Resend OTP"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{type:r.watch("showPassword")?"text":"password",placeholder:"Enter new password",...r.register("newPassword")}),e.jsx(w,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>r.setValue("showPassword",!r.watch("showPassword")),children:r.watch("showPassword")?e.jsx(T,{size:16}):e.jsx(C,{size:16})})]}),r.formState.errors.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.formState.errors.newPassword.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{type:r.watch("showConfirmPassword")?"text":"password",placeholder:"Confirm new password",...r.register("confirmPassword")}),e.jsx(w,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>r.setValue("showConfirmPassword",!r.watch("showConfirmPassword")),children:r.watch("showConfirmPassword")?e.jsx(T,{size:16}):e.jsx(C,{size:16})})]}),r.formState.errors.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.formState.errors.confirmPassword.message})]})]}),e.jsx(w,{type:"submit",className:"mt-4 w-full",disabled:f,children:f?"Resetting Password...":"Reset Password"})]})})]}),e.jsx(W,{})]})},Y=G("/(auth)/forgot-password")({component:U});export{Y as Route};
