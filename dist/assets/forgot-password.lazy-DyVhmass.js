import{Z as y,_ as v,r as u,u as B,$ as N,a0 as S,a1 as i,j as e,Q as V,U as q,q as $,V as D,a2 as A,a3 as M,W,I as p,B as f,a4 as T,a5 as E,Y as H,z as n,c as Q}from"./index-DwmgJXFJ.js";const j={forgotPassword:async a=>{try{const t=await y("/auth/forgot-password",a);return v(t)}catch(t){throw t instanceof Error?new Error(t.message):t}},resetPassword:async a=>{try{const t=await y("/auth/reset-password",a);return v(t)}catch(t){throw t instanceof Error?new Error(t.message):t}}},U=i.object({email:i.string().email("Invalid email address").optional().or(i.literal("")),phone:i.string().regex(/^\+91\d{10}$/,"Invalid phone number").optional().or(i.literal(""))}).refine(a=>{var t,l;return!!((t=a.email)!=null&&t.trim()||(l=a.phone)!=null&&l.trim())},{message:"Either email or phone is required",path:["email"]}),Y=i.object({otp:i.string().length(4,"OTP must be 4 digits"),newPassword:i.string().min(1,"Password is required"),confirmPassword:i.string().min(1,"Confirm Password is required"),showPassword:i.boolean().default(!1),showConfirmPassword:i.boolean().default(!1)}).refine(a=>a.newPassword===a.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]}),Z=()=>{const[a,t]=u.useState(1),[l,C]=u.useState({type:"",value:""}),[w,g]=u.useState(300),[O,P]=u.useState(!1),[x,h]=u.useState(!1),k=B(),m=N({resolver:S(U),defaultValues:{email:"",phone:""}}),s=N({resolver:S(Y),defaultValues:{otp:"",newPassword:"",confirmPassword:"",showPassword:!1,showConfirmPassword:!1}});u.useEffect(()=>{let r;return a===2&&w>0?r=setInterval(()=>{g(o=>o-1)},1e3):w===0&&P(!0),()=>{r&&clearInterval(r)}},[a,w]);const R=r=>{const o=Math.floor(r/60),d=r%60;return`${o}:${d.toString().padStart(2,"0")}`},F=async r=>{var o,d;try{h(!0);const c={email:((o=r.email)==null?void 0:o.trim())||void 0,phone:((d=r.phone)==null?void 0:d.trim())||void 0},L=c.email?{email:c.email}:{phone:c.phone},b=await j.forgotPassword(L);if(!b.success){n.error(b.message||"Failed to send OTP");return}C({type:c.email?"email":"phone",value:c.email||c.phone||""}),t(2),g(300),P(!1),n.success("OTP sent successfully")}catch(c){c instanceof Error?n.error(c.message):n.error("Failed to send OTP. Please try again.")}finally{h(!1)}},z=async()=>{try{h(!0);const r=l.type==="email"?{email:l.value}:{phone:l.value},o=await j.forgotPassword(r);if(!o.success){n.error(o.message||"Failed to resend OTP");return}g(300),P(!1),n.success("OTP resent successfully")}catch(r){r instanceof Error?n.error(r.message):n.error("Failed to resend OTP. Please try again.")}finally{h(!1)}},I=async r=>{try{h(!0);const o={otp:r.otp,newPassword:r.newPassword,[l.type]:l.value},d=await j.resetPassword(o);if(!d.success){n.error(d.message||"Failed to reset password");return}n.success("Password reset successfully"),setTimeout(()=>k({to:"/sign-in"}),3e3)}catch(o){o instanceof Error?n.error(o.message):n.error("Failed to reset password. Please try again.")}finally{h(!1)}};return e.jsxs("section",{className:"mx-auto flex min-h-screen items-center justify-center bg-background px-4 py-6 sm:p-8 md:p-10",children:[e.jsxs(V,{className:"mx-auto w-full max-w-xl border-gray-300 p-4",children:[e.jsxs(q,{children:[e.jsx("div",{className:"flex items-center justify-center text-xl font-bold text-blue-800",children:e.jsx($,{to:"/",children:e.jsx("img",{src:D,alt:"BPP Logo",className:"w-[120px] rounded-lg object-contain"})})}),e.jsxs("h2",{className:"text-center text-2xl font-black text-neutral-800 dark:text-neutral-200",children:[e.jsx("div",{children:"Welcome to"}),e.jsx("div",{style:{color:"#79A5F2"},children:"Bharatiya Popular Party"})]}),e.jsx(A,{className:"text-lg",children:"Reset Password"}),e.jsx(M,{children:a===1?"Enter your email or phone number to receive OTP":"Enter the OTP and your new password"})]}),e.jsx(W,{children:a===1?e.jsxs("form",{onSubmit:m.handleSubmit(F),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Email"}),e.jsx(p,{type:"email",...m.register("email"),placeholder:"Enter email"}),m.formState.errors.email&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:m.formState.errors.email.message})]}),e.jsx("p",{className:"my-2 text-center",children:"OR"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Phone"}),e.jsx(p,{placeholder:"+91 Phone number",...m.register("phone")}),m.formState.errors.phone&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:m.formState.errors.phone.message})]}),e.jsx(f,{type:"submit",className:"mt-4 w-full",disabled:x,children:x?"Sending OTP...":"Send OTP"})]}):e.jsxs("form",{onSubmit:s.handleSubmit(I),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:l.type==="email"?"Email":"Phone"}),e.jsx(p,{value:l.value,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"OTP"}),e.jsx(p,{placeholder:"Enter 4-digit OTP",maxLength:4,type:"text",inputMode:"numeric",...s.register("otp")}),s.formState.errors.otp&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:s.formState.errors.otp.message}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Time remaining: ",R(w)]}),O&&e.jsx(f,{type:"button",variant:"link",className:"h-auto p-0 text-blue-600",onClick:z,disabled:x,children:"Resend OTP"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{type:s.watch("showPassword")?"text":"password",placeholder:"Enter new password",...s.register("newPassword")}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>s.setValue("showPassword",!s.watch("showPassword")),children:s.watch("showPassword")?e.jsx(T,{size:16}):e.jsx(E,{size:16})})]}),s.formState.errors.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:s.formState.errors.newPassword.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{type:s.watch("showConfirmPassword")?"text":"password",placeholder:"Confirm new password",...s.register("confirmPassword")}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>s.setValue("showConfirmPassword",!s.watch("showConfirmPassword")),children:s.watch("showConfirmPassword")?e.jsx(T,{size:16}):e.jsx(E,{size:16})})]}),s.formState.errors.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:s.formState.errors.confirmPassword.message})]})]}),e.jsx(f,{type:"submit",className:"mt-4 w-full",disabled:x,children:x?"Resetting Password...":"Reset Password"})]})})]}),e.jsx(H,{})]})},G=Q("/(auth)/forgot-password")({component:Z});export{G as Route};
