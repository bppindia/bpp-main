import{H as B,r as v,ah as I,ai as D,aj as l,j as e,aO as A,aP as i,aQ as n,aR as o,aS as d,aT as c,au as S,h as y,i as P,k as C,l as b,S as r,I as x,B as E,J as p,c as U}from"./index-6DBbUsVV.js";import{p as F,C as V}from"./profile.service-iZEZaiSM.js";import{I as q}from"./image-upload-DsneUmNV.js";const L=l.object({profilePicture:l.string().optional(),title:l.enum(["Mr","Ms","Mrs","Dr","CA","CS","Adv"]).optional(),firstName:l.string().min(2,{message:"First name must be at least 2 characters."}),middleName:l.string().optional(),lastName:l.string().min(2,{message:"Last name must be at least 2 characters."}),dateOfBirth:l.string().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"Date must be in YYYY-MM-DD format."}),age:l.number().min(18,{message:"Age must be at least 18."}).max(120),gender:l.enum(["male","female","other"],{required_error:"Please select a gender."})});function T(){var u;const{user:s,updateUser:O}=B(),[g,f]=v.useState(!0),t=I({resolver:D(L),defaultValues:{profilePicture:((u=s==null?void 0:s.profilePicture)==null?void 0:u.toString())??"",title:s==null?void 0:s.title,firstName:(s==null?void 0:s.firstName)??"",middleName:(s==null?void 0:s.middleName)??"",lastName:(s==null?void 0:s.lastName)??"",dateOfBirth:(s==null?void 0:s.dateOfBirth)??"",age:(s==null?void 0:s.age)??18,gender:(s==null?void 0:s.gender)??"male"},mode:"onChange"});v.useEffect(()=>{var a;s&&(t.reset({profilePicture:((a=s.profilePicture)==null?void 0:a.toString())??"",title:s.title,firstName:s.firstName,middleName:s.middleName,lastName:s.lastName,dateOfBirth:s.dateOfBirth,age:s.age,gender:s.gender}),f(!1))},[s,t]);const M=async a=>{var h,N;try{if(f(!0),a.profilePicture!==(s==null?void 0:s.profilePicture)){const m=await F.requestUpdate({updates:{profilePicture:a.profilePicture},type:"NON_SENSITIVE"});m.data.success&&m.data.data&&(O({...s,profilePicture:a.profilePicture}),p.success("Profile picture updated successfully"))}const j={title:a.title,firstName:a.firstName,middleName:a.middleName,lastName:a.lastName,dateOfBirth:a.dateOfBirth,age:a.age,gender:a.gender};JSON.stringify(j)!==JSON.stringify({title:s==null?void 0:s.title,firstName:s==null?void 0:s.firstName,middleName:s==null?void 0:s.middleName,lastName:s==null?void 0:s.lastName,dateOfBirth:s==null?void 0:s.dateOfBirth,age:s==null?void 0:s.age,gender:s==null?void 0:s.gender})?(await F.requestUpdate({updates:{personal:j},type:"SENSITIVE"})).data.success&&p.success("Personal details update request sent for approval"):p.info("No changes detected in personal details")}catch(j){const m=j;p.error(((N=(h=m.response)==null?void 0:h.data)==null?void 0:N.message)||"Failed to update personal details")}finally{f(!1)}};return e.jsx(e.Fragment,{children:g?e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading personal details..."}):e.jsx(A,{...t,children:e.jsxs("form",{id:"personal-form",onSubmit:t.handleSubmit(M),className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Profile Picture"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload or update your profile picture (no approval required)"})]}),e.jsx(i,{control:t.control,name:"profilePicture",render:({field:a})=>e.jsxs(n,{children:[e.jsx(o,{children:"Profile Picture"}),e.jsx(d,{children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(q,{value:a.value,onChange:a.onChange,onRemove:()=>a.onChange("")})})}),e.jsx(c,{})]})})]}),e.jsx(S,{className:"my-6"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Personal Details"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your personal information (requires admin approval, can only be updated every 3 months)"})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(i,{control:t.control,name:"title",render:({field:a})=>e.jsxs(n,{children:[e.jsx(o,{children:"Title"}),e.jsxs(y,{onValueChange:a.onChange,defaultValue:a.value,disabled:!!(s!=null&&s.title),children:[e.jsx(d,{children:e.jsx(P,{children:e.jsx(C,{placeholder:"Select title"})})}),e.jsxs(b,{children:[e.jsx(r,{value:"Mr",children:"Mr"}),e.jsx(r,{value:"Ms",children:"Ms"}),e.jsx(r,{value:"Mrs",children:"Mrs"}),e.jsx(r,{value:"Dr",children:"Dr"}),e.jsx(r,{value:"CA",children:"CA"}),e.jsx(r,{value:"CS",children:"CS"}),e.jsx(r,{value:"Adv",children:"Adv"})]})]}),e.jsx(c,{})]})}),e.jsx(i,{control:t.control,name:"firstName",render:({field:a})=>e.jsxs(n,{children:[e.jsx(o,{children:"First Name"}),e.jsx(d,{children:e.jsx(x,{...a})}),e.jsx(c,{})]})}),e.jsx(i,{control:t.control,name:"middleName",render:({field:a})=>e.jsxs(n,{children:[e.jsx(o,{children:"Middle Name"}),e.jsx(d,{children:e.jsx(x,{...a})}),e.jsx(c,{})]})}),e.jsx(i,{control:t.control,name:"lastName",render:({field:a})=>e.jsxs(n,{children:[e.jsx(o,{children:"Last Name"}),e.jsx(d,{children:e.jsx(x,{...a})}),e.jsx(c,{})]})}),e.jsx(i,{control:t.control,name:"dateOfBirth",render:({field:a})=>e.jsxs(n,{children:[e.jsx(o,{children:"Date of Birth"}),e.jsx(d,{children:e.jsx(x,{type:"date",...a})}),e.jsx(c,{})]})}),e.jsx(i,{control:t.control,name:"age",render:({field:a})=>e.jsxs(n,{children:[e.jsx(o,{children:"Age"}),e.jsx(d,{children:e.jsx(x,{type:"number",...a,onChange:h=>a.onChange(parseInt(h.target.value,10))})}),e.jsx(c,{})]})}),e.jsx(i,{control:t.control,name:"gender",render:({field:a})=>e.jsxs(n,{children:[e.jsx(o,{children:"Gender"}),e.jsxs(y,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(d,{children:e.jsx(P,{children:e.jsx(C,{placeholder:"Select gender"})})}),e.jsxs(b,{children:[e.jsx(r,{value:"male",children:"Male"}),e.jsx(r,{value:"female",children:"Female"}),e.jsx(r,{value:"other",children:"Other"})]})]}),e.jsx(c,{})]})})]})]}),e.jsx(S,{className:"my-6"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(E,{type:"submit",disabled:g,children:"Update personal details"})})]})})})}function R(){return e.jsx(V,{title:"Profile",desc:"This is how others will see you on the site.",children:e.jsx(T,{})})}const z=U("/dashboard/profile/")({component:R});export{z as Route};
