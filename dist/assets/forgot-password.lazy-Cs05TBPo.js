import{Z as v,_ as j,$ as N,r as u,u as V,a0 as S,a1 as E,a2 as i,j as e,Q as q,U as $,q as D,V as A,a3 as M,a4 as W,W as H,I as p,B as f,a5 as T,a6 as C,Y as Q,z as n,c as U}from"./index-CImB3oEU.js";const y={forgotPassword:async s=>{try{const a=await j("/auth/forgot-password",s);return N(a)}catch(a){throw a instanceof Error?new Error(a.message):a}},resetPassword:async s=>{try{const a=await j("/auth/reset-password",s);return N(a)}catch(a){throw a instanceof Error?new Error(a.message):a}},logout:async()=>{try{return v.remove("authToken"),v.remove("sessionId"),await j("/auth/logout",{}),{success:!0,message:"Logged out successfully"}}catch(s){throw s instanceof Error?new Error(s.message):s}}},Y=i.object({email:i.string().email("Invalid email address").optional().or(i.literal("")),phone:i.string().regex(/^\+91\d{10}$/,"Invalid phone number").optional().or(i.literal(""))}).refine(s=>{var a,l;return!!((a=s.email)!=null&&a.trim()||(l=s.phone)!=null&&l.trim())},{message:"Either email or phone is required",path:["email"]}),Z=i.object({otp:i.string().length(4,"OTP must be 4 digits"),newPassword:i.string().min(1,"Password is required"),confirmPassword:i.string().min(1,"Confirm Password is required"),showPassword:i.boolean().default(!1),showConfirmPassword:i.boolean().default(!1)}).refine(s=>s.newPassword===s.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]}),_=()=>{const[s,a]=u.useState(1),[l,O]=u.useState({type:"",value:""}),[x,g]=u.useState(300),[k,P]=u.useState(!1),[w,h]=u.useState(!1),R=V(),m=S({resolver:E(Y),defaultValues:{email:"",phone:""}}),r=S({resolver:E(Z),defaultValues:{otp:"",newPassword:"",confirmPassword:"",showPassword:!1,showConfirmPassword:!1}});u.useEffect(()=>{let t;return s===2&&x>0?t=setInterval(()=>{g(o=>o-1)},1e3):x===0&&P(!0),()=>{t&&clearInterval(t)}},[s,x]);const F=t=>{const o=Math.floor(t/60),d=t%60;return`${o}:${d.toString().padStart(2,"0")}`},I=async t=>{var o,d;try{h(!0);const c={email:((o=t.email)==null?void 0:o.trim())||void 0,phone:((d=t.phone)==null?void 0:d.trim())||void 0},B=c.email?{email:c.email}:{phone:c.phone},b=await y.forgotPassword(B);if(!b.success){n.error(b.message||"Failed to send OTP");return}O({type:c.email?"email":"phone",value:c.email||c.phone||""}),a(2),g(300),P(!1),n.success("OTP sent successfully")}catch(c){c instanceof Error?n.error(c.message):n.error("Failed to send OTP. Please try again.")}finally{h(!1)}},z=async()=>{try{h(!0);const t=l.type==="email"?{email:l.value}:{phone:l.value},o=await y.forgotPassword(t);if(!o.success){n.error(o.message||"Failed to resend OTP");return}g(300),P(!1),n.success("OTP resent successfully")}catch(t){t instanceof Error?n.error(t.message):n.error("Failed to resend OTP. Please try again.")}finally{h(!1)}},L=async t=>{try{h(!0);const o={otp:t.otp,newPassword:t.newPassword,[l.type]:l.value},d=await y.resetPassword(o);if(!d.success){n.error(d.message||"Failed to reset password");return}n.success("Password reset successfully"),setTimeout(()=>R({to:"/sign-in"}),3e3)}catch(o){o instanceof Error?n.error(o.message):n.error("Failed to reset password. Please try again.")}finally{h(!1)}};return e.jsxs("section",{className:"mx-auto flex min-h-screen items-center justify-center bg-background px-4 py-6 sm:p-8 md:p-10",children:[e.jsxs(q,{className:"mx-auto w-full max-w-xl border-gray-300 p-4",children:[e.jsxs($,{children:[e.jsx("div",{className:"flex items-center justify-center text-xl font-bold text-blue-800",children:e.jsx(D,{to:"/",children:e.jsx("img",{src:A,alt:"BPP Logo",className:"w-[120px] rounded-lg object-contain"})})}),e.jsxs("h2",{className:"text-center text-2xl font-black text-neutral-800 dark:text-neutral-200",children:[e.jsx("div",{children:"Welcome to"}),e.jsx("div",{style:{color:"#79A5F2"},children:"Bharatiya Popular Party"})]}),e.jsx(M,{className:"text-lg",children:"Reset Password"}),e.jsx(W,{children:s===1?"Enter your email or phone number to receive OTP":"Enter the OTP and your new password"})]}),e.jsx(H,{children:s===1?e.jsxs("form",{onSubmit:m.handleSubmit(I),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Email"}),e.jsx(p,{type:"email",...m.register("email"),placeholder:"Enter email"}),m.formState.errors.email&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:m.formState.errors.email.message})]}),e.jsx("p",{className:"my-2 text-center",children:"OR"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Phone"}),e.jsx(p,{placeholder:"+91 Phone number",...m.register("phone")}),m.formState.errors.phone&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:m.formState.errors.phone.message})]}),e.jsx(f,{type:"submit",className:"mt-4 w-full",disabled:w,children:w?"Sending OTP...":"Send OTP"})]}):e.jsxs("form",{onSubmit:r.handleSubmit(L),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:l.type==="email"?"Email":"Phone"}),e.jsx(p,{value:l.value,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"OTP"}),e.jsx(p,{placeholder:"Enter 4-digit OTP",maxLength:4,type:"text",inputMode:"numeric",...r.register("otp")}),r.formState.errors.otp&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.formState.errors.otp.message}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Time remaining: ",F(x)]}),k&&e.jsx(f,{type:"button",variant:"link",className:"h-auto p-0 text-blue-600",onClick:z,disabled:w,children:"Resend OTP"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{type:r.watch("showPassword")?"text":"password",placeholder:"Enter new password",...r.register("newPassword")}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>r.setValue("showPassword",!r.watch("showPassword")),children:r.watch("showPassword")?e.jsx(T,{size:16}):e.jsx(C,{size:16})})]}),r.formState.errors.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.formState.errors.newPassword.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{type:r.watch("showConfirmPassword")?"text":"password",placeholder:"Confirm new password",...r.register("confirmPassword")}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>r.setValue("showConfirmPassword",!r.watch("showConfirmPassword")),children:r.watch("showConfirmPassword")?e.jsx(T,{size:16}):e.jsx(C,{size:16})})]}),r.formState.errors.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:r.formState.errors.confirmPassword.message})]})]}),e.jsx(f,{type:"submit",className:"mt-4 w-full",disabled:w,children:w?"Resetting Password...":"Reset Password"})]})})]}),e.jsx(Q,{})]})},J=U("/(auth)/forgot-password")({component:_});export{J as Route};
