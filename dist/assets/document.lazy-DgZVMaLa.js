import{H as O,r as C,ah as U,ai as V,aj as n,j as e,aO as A,au as p,aP as i,aQ as c,aR as l,aS as m,I,c1 as S,aT as h,B as E,J as x,c as R}from"./index-6DBbUsVV.js";import{p as F,C as k}from"./profile.service-iZEZaiSM.js";import{I as u}from"./image-upload-DsneUmNV.js";const q=n.object({aadhaar:n.object({number:n.string().regex(/^\d{12}$/,{message:"Aadhaar number must be 12 digits."}).optional(),front:n.string().optional(),back:n.string().optional(),updateCount:n.number().optional()}).optional(),voter:n.object({number:n.string().optional(),front:n.string().optional(),back:n.string().optional(),updateCount:n.number().optional()}).optional()});function w(){const{user:o}=O(),[v,j]=C.useState(!0),r=U({resolver:V(q),defaultValues:{aadhaar:(o==null?void 0:o.aadhaar)??void 0,voter:(o==null?void 0:o.voter)??void 0},mode:"onChange"});C.useEffect(()=>{o&&(r.reset({aadhaar:o.aadhaar??void 0,voter:o.voter??void 0}),j(!1))},[o,r]);const J=async a=>{var t,d,f,y,N,b;try{j(!0);const s=o;JSON.stringify(a.aadhaar)!==JSON.stringify(s==null?void 0:s.aadhaar)&&(((t=s==null?void 0:s.aadhaar)==null?void 0:t.updateCount)??0)<2?(await F.requestUpdate({updates:{aadhaar:a.aadhaar},type:"SENSITIVE"})).data.success&&x.success("Aadhaar update request sent for approval"):(((d=s==null?void 0:s.aadhaar)==null?void 0:d.updateCount)??0)>=2&&x.error("Aadhaar details can only be updated twice"),JSON.stringify(a.voter)!==JSON.stringify(s==null?void 0:s.voter)&&(((f=s==null?void 0:s.voter)==null?void 0:f.updateCount)??0)<2?(await F.requestUpdate({updates:{voter:a.voter},type:"SENSITIVE"})).data.success&&x.success("Voter ID update request sent for approval"):(((y=s==null?void 0:s.voter)==null?void 0:y.updateCount)??0)>=2&&x.error("Voter ID details can only be updated twice"),JSON.stringify(a.aadhaar)===JSON.stringify(s==null?void 0:s.aadhaar)&&JSON.stringify(a.voter)===JSON.stringify(s==null?void 0:s.voter)&&x.info("No changes detected in documents")}catch(s){const g=s;x.error(((b=(N=g.response)==null?void 0:N.data)==null?void 0:b.message)||"Failed to update documents")}finally{j(!1)}};return e.jsx(e.Fragment,{children:v?e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading document details..."}):e.jsx(A,{...r,children:e.jsxs("form",{id:"documents-form",onSubmit:r.handleSubmit(J),className:"space-y-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Aadhaar Card"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your Aadhaar card details and upload images (max 2 updates allowed)"})]}),e.jsx(p,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(i,{control:r.control,name:"aadhaar.number",render:({field:a})=>{var t,d;return e.jsxs(c,{children:[e.jsx(l,{children:"Aadhaar Number"}),e.jsx(m,{children:e.jsx(I,{...a,disabled:(((t=o==null?void 0:o.aadhaar)==null?void 0:t.updateCount)??0)>=2})}),e.jsxs(S,{children:["Aadhaar changes require admin approval (Update count:"," ",((d=o==null?void 0:o.aadhaar)==null?void 0:d.updateCount)??0,"/2)"]}),e.jsx(h,{})]})}}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(i,{control:r.control,name:"aadhaar.front",render:({field:a})=>e.jsxs(c,{children:[e.jsx(l,{children:"Front Image"}),e.jsx(m,{children:e.jsx(u,{value:a.value,onChange:a.onChange,onRemove:()=>a.onChange("")})}),e.jsx(h,{})]})}),e.jsx(i,{control:r.control,name:"aadhaar.back",render:({field:a})=>e.jsxs(c,{children:[e.jsx(l,{children:"Back Image"}),e.jsx(m,{children:e.jsx(u,{value:a.value,onChange:a.onChange,onRemove:()=>a.onChange("")})}),e.jsx(h,{})]})})]})]})]}),e.jsx(p,{className:"my-6"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Voter ID Card"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your Voter ID card details and upload images (max 2 updates allowed)"})]}),e.jsx(p,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(i,{control:r.control,name:"voter.number",render:({field:a})=>{var t,d;return e.jsxs(c,{children:[e.jsx(l,{children:"Voter ID Number"}),e.jsx(m,{children:e.jsx(I,{...a,disabled:(((t=o==null?void 0:o.voter)==null?void 0:t.updateCount)??0)>=2})}),e.jsxs(S,{children:["Voter ID changes require admin approval (Update count:"," ",((d=o==null?void 0:o.voter)==null?void 0:d.updateCount)??0,"/2)"]}),e.jsx(h,{})]})}}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(i,{control:r.control,name:"voter.front",render:({field:a})=>e.jsxs(c,{children:[e.jsx(l,{children:"Front Image"}),e.jsx(m,{children:e.jsx(u,{value:a.value,onChange:a.onChange,onRemove:()=>a.onChange("")})}),e.jsx(h,{})]})}),e.jsx(i,{control:r.control,name:"voter.back",render:({field:a})=>e.jsxs(c,{children:[e.jsx(l,{children:"Back Image"}),e.jsx(m,{children:e.jsx(u,{value:a.value,onChange:a.onChange,onRemove:()=>a.onChange("")})}),e.jsx(h,{})]})})]})]})]}),e.jsx(p,{className:"my-6"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(E,{type:"submit",disabled:v,children:"Update documents"})})]})})})}function B(){return e.jsx(k,{title:"Identity Documents",desc:"Manage your identity documents and verification details.",children:e.jsx(w,{})})}const M=R("/dashboard/profile/document")({component:B});export{M as Route};
