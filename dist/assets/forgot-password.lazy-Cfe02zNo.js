import{r as t,u as W,j as e,y as G,z as Q,H as U,J as X,A as Y,I as o,B as m,K as z,O as F,F as Z,w as u,c as ee}from"./index-D6DTtz0_.js";import{b as se}from"./Bpp-VPVi5Vma.js";const te=()=>{const[v,I]=t.useState(1),[a,V]=t.useState(""),[r,q]=t.useState(""),[p,B]=t.useState(""),[n,D]=t.useState(""),[i,J]=t.useState(""),[d,L]=t.useState({type:"",value:""}),[h,A]=t.useState(!1),[x,H]=t.useState(!1),[P,f]=t.useState(""),[g,w]=t.useState(""),[N,E]=t.useState(""),[S,C]=t.useState(""),[O,j]=t.useState(""),_=W(),T=s=>s&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)?(f("Invalid email address"),!1):(f(""),!0),k=s=>s&&!/^\+91\d{10}$/.test(s)?(w("Invalid phone number"),!1):(w(""),!0),R=s=>!s||s.length!==4?(E("OTP must be 4 digits"),!1):(E(""),!0),y=()=>{let s=!0;return n?C(""):(C("Password is required"),s=!1),i?n!==i?(j("Passwords do not match"),s=!1):j(""):(j("Confirm Password is required"),s=!1),s},$=async s=>{s.preventDefault();const l=T(a),b=k(r);if(!a&&!r){f("Either email or phone is required"),w("Either email or phone is required");return}if(!(a&&!l||r&&!b))try{if(!(await fetch("https://api.bppindia.com/api/v1/forgot-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a?{email:a}:{phone:r})})).ok)throw new Error("Failed to send OTP");L({type:a?"email":"phone",value:a||r}),I(2),u.success("OTP sent successfully")}catch{u.error("Failed to send OTP. Please try again.")}},K=async s=>{s.preventDefault();const l=R(p),b=y();if(!(!l||!b))try{const c={otp:p,newPassword:n,[d.type]:d.value};if(!(await fetch("https://api.bppindia.com:3000/api/v1/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})).ok)throw new Error("Failed to reset password");u.success("Password reset successfully"),setTimeout(()=>{_({to:"/sign-in"})},3e3)}catch{u.error("Failed to reset password. Please try again.")}};return e.jsxs("section",{className:"mx-auto flex h-screen items-center justify-center rounded-none py-10 md:rounded-3xl md:p-8",children:[e.jsxs(G,{className:"mx-auto w-full max-w-md border-gray-300 p-4",children:[e.jsxs(Q,{children:[e.jsx("div",{className:"flex items-center justify-center text-xl font-bold text-blue-800",children:e.jsx("img",{src:se,alt:"",className:"w-[120px] rounded-lg object-contain"})}),e.jsxs("h2",{className:"text-center text-2xl font-black text-neutral-800 dark:text-neutral-200",children:[e.jsx("div",{children:"Welcome to"}),e.jsx("div",{style:{color:"#79A5F2"},children:"Bharatiya Popular Party"})]}),e.jsx(U,{className:"text-lg",children:"Reset Password"}),e.jsx(X,{children:v===1?"Enter your email or phone number to receive OTP":"Enter the OTP and your new password"})]}),e.jsx(Y,{children:v===1?e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Email"}),e.jsx(o,{type:"email",name:"email",placeholder:"Enter email",value:a,onChange:s=>{V(s.target.value),T(s.target.value)}}),P&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:P})]}),e.jsx("p",{className:"my-2 text-center",children:"OR"}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Phone"}),e.jsx(o,{placeholder:"+91 Phone number",value:r,name:"phone",onChange:s=>{q(s.target.value),k(s.target.value)}}),g&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:g})]}),e.jsx(m,{type:"submit",className:"mt-4 w-full",children:"Send OTP"})]}):e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:d.type==="email"?"Email":"Phone"}),e.jsx(o,{value:d.value,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"OTP"}),e.jsx(o,{placeholder:"Enter 6-digit OTP",maxLength:6,type:"text",name:"otp",inputMode:"numeric",value:p,onChange:s=>{B(s.target.value),R(s.target.value)}}),N&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:N})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(o,{type:h?"text":"password",placeholder:"Enter new password",name:"newPassword",value:n,onChange:s=>{D(s.target.value),i&&y()}}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>A(!h),children:h?e.jsx(z,{size:16}):e.jsx(F,{size:16})})]}),S&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:S})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(o,{type:x?"text":"password",placeholder:"Confirm new password",value:i,name:"confirmPassword",onChange:s=>{J(s.target.value),n&&y()}}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>H(!x),children:x?e.jsx(z,{size:16}):e.jsx(F,{size:16})})]}),O&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:O})]})]}),e.jsx(m,{type:"submit",className:"mt-4 w-full",children:"Reset Password"})]})})]}),e.jsx(Z,{})]})},oe=ee("/(auth)/forgot-password")({component:te});export{oe as Route};
